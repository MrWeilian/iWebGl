# 2. 图形学的数学基础

上一小节我们初步接触了图形的二维变换，实现了三角形的平移、缩放、旋转。但不知道大家有没有发现，每实现一种图形变换我们都需要**重新实现一次对应的顶点着色器**，简单来说就是 **`gl_Position` 的赋值等式都在变化**，一时加、一时乘、一时三角函数公式...

其实这一切不同的计算等式，我们都可以借助 **矩阵** 来帮我们进行简化！那矩阵是什么呢？怎么用，怎么简化我们的着色器代码呢？好，带着这些疑问，这一节我们暂时放下 WebGL 的学习，先来补一补在图形学当中也非常重要的一些数学基础知识——矢量、矩阵。

> 当然本文的内容比较干...可能会让大家觉得枯燥和难理解。如果是这样，那么我建议大家可以**结合下一小节的内容**进行学习，或者直接学习下一小节的内容，碰到相关的数学知识再返回本文进行补充学习。

## 认识矢量

在 [维基百科](https://zh.wikipedia.org/wiki/%E5%90%91%E9%87%8F) 中是这么介绍矢量的：

> 向量（英语：**vector**），物理、工程等也称作**矢量** 、欧几里得向量（Euclidean vector），是数学、物理学和工程科学等多个自然科学中的基本概念。指一个**同时具有大小和方向**，且满足平行四边形法则的几何对象。

这里我们顺便注意一下一个英文单词——**vector**，是不是有点像我们见过的 `vec4` 的类型呢？其实对于概念这东西，大致了解就好，我们更主要的是知道怎么把矢量应用到开发工作中，并且要了解关于矢量的一些运算法则～

### 矢量在 WebGL 中的应用

说到这一点，我们并不陌生。回顾之前在编写着色器代码时用过的 `gl_Position`、`gl_FragColor` 等，他们都是 `vec4` 类型的内置变量。这里回顾一下 `vec4` 类型，它表示由 `4` 个浮点数组成的**矢量**！（忘了的赶紧回到 [第二章-顶点着色器](/content/二、WebGL基础/2.%20WebGL绘制点.html#_1-顶点着色器) 温习一下）

这个矢量对于 `gl_Position` 来说，它代表了三维空间中的坐标点的信息；对于 `gl_FragColor` 来说它代表了颜色的 `RGBA` 值。

对于坐标、或者颜色等这类的矢量值，我们在 GLSL 中可以通过 **点操作符 `.` 配合 `key` 值来访问到对应分量的值**。这一点之前没有正式介绍过，不过有看过一些示例程序代码的你可能早就已经发现了！比如在讲锯齿消除实战的文章中有用到 `gl_FragCoord.x` 来获取片元着色器中当前片元的 `x` 值；上一小节实战三角形旋转的时候也通过 `a_Position.x` 来获取对应的顶点坐标值。

讲到这里，你已经对 WebGL 中矢量的应用有一定的了解了，那接下来我们就开始了解一些关于**矢量的运算法则**，毕竟这个在我们以后的开发过程中是会经常碰到的！就好比上一节中实战的三角形平移，就用到了**矢量之间的加法运算**；实战三角形缩放，就用到了**矢量和标量的乘积**......

## 1. 矢量加减法

其实对于矢量的加减法我们应该并不陌生，只是大家可能已经忘得差不多了。我们通过下图来看看矢量在空间中的加减法的表示：

![2.1](../../public/images/fourth/2.1.png)

上图是不是非常熟悉，以前绝对见到过！可以看到当 `矢量a` + `矢量b` 可以得到一个新的矢量；当 `矢量a` - `矢量b` 时，同等于 `矢量a` 加上了一个**反方向**的 `矢量b`。

那么其实在算数层面，矢量的加减法则跟标量的是一样的。之前的文章也有使用过**矢量的加减法来实现图形的平移效果**，直接看等式吧：

```C
// vec3 类型相加
vec3(x1, y1, z1) + vec4(x2, y2, z2) = vec3(x1 + x2, y1 + y2, z1 + z2)
// vec4 类型相加
vec4(x1, y1, z1, w1) + vec4(x2, y2, z2, w2) = vec4(x1 + x2, y1 + y2, z1 + z2, w1 + w2)
```

上述代码块看到了熟悉的坐标矢量相加，但注意我特地例举了 `vec3` 、`vec4` **两种类型之间相加**，所以这里我们要注意的一点就是：矢量的加减法要在**同类型的矢量**中运算。那么矢量的减法我就不在这里演示了，就如上文提到的，把减去的矢量**取个反方向**，再相加就是矢量之间的减法了。

当然，矢量加法也满足以下定律：
- 交换律： `矢量a` + `矢量b` = `矢量b` + `矢量b`
- 结合律： (`矢量a` + `矢量b`) + `矢量c` = `矢量b` + (`矢量b` + `矢量c`)

## 2. 矢量乘法

### 单位矢量

单位矢量是大小为**单位长度**的矢量，并且它就是这个方向上的**单位矢量**。

上面提到 **单位长度** ，我们先简单过一下**矢量长度**怎么算。其实他的计算公式跟勾股定理很像的（两条直角边的平方相加 = 斜边的平方），但是它不要求是直角三角形这个硬条件而已！公式如下：

![2.3](../../public/images/fourth/2.3.png)

在三维坐标系中，`i(1, 0, 0)`、`j(0, 1, 0)`、`k(0, 0, 1)` 分别为 `x`、`y`、`z` 轴上的单位矢量。

### 标量乘矢量

标量乘矢量我们并不陌生，其实在实现三角形缩放的时候我们已经用过了！其实就是把标量跟矢量中的每个分量相乘，得到一个方向相同或者相反，大小是 n 倍的矢量。

他们的等式如下：
```C
n * vec4(x, y, z, w) = vec4(nx, ny, nz, nw)
```

### 数量积（点积）

在讲数量积之前，先前置一个知识点：数量积和矢量积（下问会讲到）的根本区别是**数量积的结果是普通的标量；矢量积的结果仍然是矢量**。哈哈哈，其实通过他们的命名就能猜到了是吧？

数量积也叫 [点积](https://zh.wikipedia.org/wiki/%E7%82%B9%E7%A7%AF) ，是**两矢量相乘后得到一个标量结果的乘法**。那他们的 [等式关系](https://zh.wikipedia.org/wiki/%E5%90%91%E9%87%8F) 为（推荐大家戳维基百科看公式）：

![2.4](../../public/images/fourth/2.4.png)

看公式很容易懵，我再通过画图来加深大家对数量积的理解和记忆：

![2.2](../../public/images/fourth/2.2.png)

如图所示，`矢量a` 和 `矢量b` 的夹角为 `θ`。根据数量积公式可以推出：`矢量b的长度 * cos(θ)` 这个的值就等于图中标**蓝色线**的长度。因为 `cos` 是**邻边比斜边**，刚好乘上 `矢量b的长度` 可以抵消分母，最后剩余**邻边的长度**。

所以基于此我们可以推出上述数量积公式即为求：
- `矢量b` 在 `矢量a` 上的 **投影长度** 与 **`矢量a`长度** 的 **乘积**（即蓝色线段长度 * `矢量a`的长度）

我们可以推导出，如果 `矢量b` **垂直于** `矢量a`，那么结果就是 `0`！

### 矢量积（叉积）

矢量积又称 [叉积](https://zh.wikipedia.org/wiki/%E5%8F%89%E7%A7%AF) ，是向量跟向量之间的乘积，但它的**结果依然是矢量**（前面也有提到）。并且两个矢量的乘积跟这两个矢量所在的平面**垂直**。如下图所示：

![2.5](../../public/images/fourth/2.5.png)

它的几何意义

```js
(x1,y1,z1) * (x2,y2,z2) = [y1z2−z1y2, z1x2−x1z2 , x1y2−y1x2]
```
