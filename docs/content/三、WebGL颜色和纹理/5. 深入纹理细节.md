# 5. 深入纹理细节

经过上一小节的学习，我们已经成功的实现了第一张纹理图像！但相信大家都意犹未尽，毕竟我们只是初步的探索了纹理图像的实现，其中还有很多的 `api` 、 参数都没~~深入探讨~~使用过～那么，本文就把他通通都过一遍，深入了解关于纹理的细节。

在正文开始前，我们回顾下实现一张纹理图像的核心步骤吧：
1. 创建纹理对象 `createTexture`
2. 激活纹理单元 `activeTexture`
3. 绑定纹理对象 `bindTexture`
4. 配置纹理对象 `texParameteri`
5. 将图像分配给纹理对象 `texImage2D`
6. 纹理单元传递给取样器 `sampler`
7. 片元着色器根据坐标抽取纹素颜色，涂到对应的片元上 `texture2D`

## 滤镜(FILTER)配置

上一小节，我们只是以绘制出第一张纹理图像为目的，很多参数都没深入，特别是配置纹理对象 `texParameteri` 相关的。那么在这一小节，我们将深入两个 `FILTER` 的填充方法的细节：
1. `gl.TEXTURE_MAG_FILTER` 放大的纹理参数。比如我们把 `4*4px` 的纹理图像映射到 `8*8px` 的模型时，由于映射的像素放大了，**WebGL 需要去填充由于图像尺寸放大产生的像素空隙**，填充的方式由我们配置或者用默认值。
2. `gl.TEXTURE_MIN_FILTER` 缩小的纹理参数。这里跟上述的原理是一样的，当图像缩小的时候会产生多余的像素，所以要"丢掉"这些多出来的像素。

回顾 [gl.texParameteri](https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texParameter) 这个 `api` ，我们所需要深入的这两个参数正是这个 `api` 的第二个参数，通过 MDN 文档我们可以了解到它的配置值和默认值如下：

| 参数                  | 描述                         | 参数值                                                                                                                                             |
|-----------------------|------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------|
| gl.TEXTURE_MAG_FILTER | Texture magnification filter | **gl.LINEAR (default value)**,<br> gl.NEAREST.                                                                                                         |
| gl.TEXTURE_MIN_FILTER | Texture minification filter  | gl.LINEAR, gl.NEAREST, gl.NEAREST_MIPMAP_NEAREST, gl.LINEAR_MIPMAP_NEAREST, **gl.NEAREST_MIPMAP_LINEAR (default value)**, gl.LINEAR_MIPMAP_LINEAR. |

从这里我们了解到 `gl.TEXTURE_MAG_FILTER` 的默认值是 `gl.LINEAR`；而 `gl.TEXTURE_MIN_FILTER` 的默认值是 `gl.NEAREST_MIPMAP_LINEAR`。关于**缩小的默认值我们可以先留意一下**，因为后面自己实战的时候可能会踩到小坑。

在我们了解放大、缩小两个纹理参数后，我们就继续深入他们的配置值，看看都有什么区别。从表中我们很快就发现了放大、缩小两个纹理参数都**共有**两个配置值，他们也是本文的主要研究对象：
1. `gl.NEAREST`
2. `gl.LINEAR`

:::demo
third/5_1
:::

### 解惑 `TEXTURE_MIN_FILTER` 

相信关于这两个 `TEXTURE_MIN_FILTER`、`TEXTURE_MAG_FILTER` 参数的配置尝试最容易让初学者产生困惑（因为我就是这样）。我是想通过差异化配置，单独看看他们带来的不同效果，**所以当我期望看看 `TEXTURE_MAG_FILTER` 的效果时我会不配置 `TEXTURE_MIN_FILTER`，但这个时候画布会突然变成一抹黑**...

也就是这个问题，一开始还挺困扰我的，所以我觉得有必要单独讲一讲，也算是给遇到这样问题的大家解解惑，节省一下代码问题排查的时间。然后我也在 [stack overflow](https://stackoverflow.com/questions/12363463/when-should-i-set-gl-texture-min-filter-and-gl-texture-mag-filter) 中找到一个比较靠谱的问答帖子，大家可以点进去看看。

回到这个问题上来，当我们想"单独"测试 `TEXTURE_MAG_FILTER` 效果时，我们应该仔细看看 [gl.texParameteri](https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texParameter) 文档中对 `gl.TEXTURE_MIN_FILTER` 这个参数值的讲解（MDN 拷贝回来的）：

表中我们关注加粗的那一个值即可，就是 **default value** 的字眼！这就是让我们遇到本小节这个问题的原因...当我们想"单独"看 `TEXTURE_MAG_FILTER` 效果时，我们往往选择单独配置其而不配置缩小的滤镜——`TEXTURE_MIN_FILTER`，然后我们会很自然而然地以为这就是我们期望的结果，但其实这只是我们以为的没配置 `gl.TEXTURE_MIN_FILTER` 参数值...（其实是有值的，而且是默认值——`gl.NEAREST_MIPMAP_LINEAR`） 
