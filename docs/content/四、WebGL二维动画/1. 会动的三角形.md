# 1. 会动的三角形

从这一章开始，我们将开始新的 WebGL 学习方向，一起探究如何实现 2D 图形的基础变化，如何实现基础的动画效果。这也是为我们后续学习 3D 图形绘制、动画的基础！看到这一章节的时候，不知道你还记不记得如何绘制点、线、三角了，要是忘了的话赶紧翻一翻前面的内容回顾一下。

在进入动画领域之前，首先让我们来一起研究如何通过 平移、旋转、翻转 来让一个三角形简单地"动"起来，let's go！

## 平移

首先我们得回顾一下如何绘制一个三角形：
1. 确定顶点坐标，存放到缓冲区对象中
2. 顶点着色器消费缓冲区数据，并赋值给 `gl_Position`
3. 片元着色器给三角形涂上颜色
4. 最后通过 `gl.drawArrays(gl.TRIANGLE_xxx, 0, 3)` 进行绘制

为什么在讲平移之前要大家先回顾三角形的绘制流程呢？因为当你回顾完一个静态的三角形是如何绘制后，你就会发现，确定三角形绘制位置相关的数据无非就是**三个顶点坐标**。所以如果我想要实现三角形的平移，那我只需要**同时**将三个顶点坐标值进行加减法操作即可。

![1.2](../../public/images/fourth/1.2.png)

如上图所示，当我们把蓝色三角形移动到绿色三角形的位置，无非就是三个顶点的 `x` 值都加上**水平方向的位移值**，`y` 值都加上**垂直方向上的位移值**而已。也就是图中的坐标从 `(x,y)` 移动到 `(x',y')` 的改变而已。坐标调整完后，我们再重新绘制一次就能实现三角形的平移了。

基于这一点，本文的目标终于从上一章节的片元着色器又转到**顶点着色器**了。现在我基于第二章的三角形的顶点着色器代码，再对其进行一个小改造：

```js
const vertexCode = `
  attribute vec4 a_Position;
  attribute vec4 a_Color;
  varying vec4 v_Color;
  // 增加一个 uniform 变量来接收变化的位置坐标值
  uniform vec4 u_Position;

  void main () {
    // 将两个位置坐标进行相加
    gl_Position = a_Position + u_Position;
    v_Color= a_Color;
  }
`
```

基于以上的顶点着色器实现，我只需要把每次改动后的坐标给到 `uniform` 变量 `u_Position` 再重新绘制图形就能实现一个可以平移的三角形了。这里我以 `x` 轴平移为例，讲解下实现 `x` 轴平移的代码：

```js
// 监听了控制 x 滑块的变化
watch(xVal, x => {
  // 获取 uniform 变量
  const u_Position = gl.getUniformLocation(program, 'u_Position')
  // 计算 x 轴的移动距离
  const move = (x - defaultOrigin) / defaultOrigin
  const y = (yVal.value - defaultOrigin) / defaultOrigin
  // 准备传递给 uniform 变量的移动距离数据（注意最后一个值为 0.）
  const xMoveVertices = new Float32Array([move, y, 0., 0.])
  // 将位移数据赋值 u_Position
  gl.uniform4fv(u_Position, xMoveVertices)
  gl.clear(gl.COLOR_BUFFER_BIT)
  // 重新绘制三角形
  gl.drawArrays(gl.TRIANGLES, 0, 3)
})
```

简单来看，上述代码就是将需要平移产生的值给到 `u_Position` 变量，再进行重新绘制的操作（重新运行着色器代码：原始值+位移值）。那其实两个矢量相加，就是矢量中的每个分量分别相加，跟我们**上一章最后一节提到的颜色相加是同一个道理**。

这里我们需要注意一点就是 **`xMoveVertices` 这个 `vec4` 类型的值的最后一位需要是 `0.`**。因为在齐次坐标中，有这样的一个关系：齐次坐标 `(x, y, z, w)` 其实等价于三维坐标 `(x/w, y/w, z/w)`，所以最后一个值 `w` 会影响 `x`、`y`、`z` 的值（如果忘了的同学可以回顾[第二章第二小节](/content/二、WebGL基础/2.%20WebGL绘制点.html#编写简单的着色器代码)）。

:::demo
fourth/1_1
:::

## 缩放

## 旋转
